<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
	<META HTTP-EQUIV="Expires" CONTENT="0"> 
    <title>Voice Tag v0.1</title>
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap-editable.css" rel="stylesheet">
<!--
	<link href="css/bootstrap-combined.min.css" rel="stylesheet">
-->
	<link href="css/carousel.css" rel="stylesheet">
  </head>
  <body role="document" id="all" style="display:none">
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://enhanceralph.github.io/voicetag/">Voice Tag</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="https://www.facebook.com/hsuehshih">Ralph's FB</a></li>
					<li class="dropdown"><a href="#about" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">About<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Editor</a></li>
							<li><a href="#">Another action</a></li>
							<li><a href="#">Something else here</a></li>
						</ul>
					</li>
					<li><a href="http://enhanceralph.github.io/voicetag/contact.html">Contact</a></li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Action</a></li>
							<li><a href="#">Another action</a></li>
							<li><a href="#">Something else here</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Nav header</li>
							<li><a href="#">Separated link</a></li>
							<li><a href="#">One more separated link</a></li>
						</ul>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right top-nav">
					<li class="dropdown"><a href="#about" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><span class="glyphicon glyphicon-cog" style="width:20px"></span><span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">XXXX</a></li>
							<li><a href="#">Another action</a></li>
							<li><a href="#">Something else here</a></li>
						</ul>
					</li>
				<ul/>
			</div>
		</div>
	</nav>
	<div style="height:40px"></div>
	<div class="container theme-showcase">
		<br/>
		<div class="row">
			<div class="col-md-3"></div>
			<div class="col-md-6">
<!--
				<div id="debug">debug info</div>
-->
				<div style="text-align:center">
					<div id="wooot"></div>
				</div>
				<div class="dropdown">
					<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
						Video List
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="dropdownMenu1list">
<!--
						<li><a href="#video1" id="video1"></a></li>
						<li><a href="#video2" id="video2"></a></li>
						<li><a href="#video3" id="video3"></a></li>
						<li><a href="#video4" id="video4">Separated link</a></li>
-->
					</ul>
				</div>
				<div class="form-group">
					<label for="usr">Youtube URL or ID:</label>
					<input type="text" class="form-control" id="vid" value="https://www.youtube.com/watch?v=jExYHd1yyWc">
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
		<div class="row">
			<div class="col-md-3"></div>
			<div class="col-md-6">
				<div>
					<button type="button" class="btn btn-default btn-lg" id="playPause">
						<span class="glyphicon glyphicon-play" id="playLogo" style="width:15px"></span>
						<span class="glyphicon glyphicon-pause" id="pauseLogo" style="width:15px;display:none"></span>
					</button>
					<button type="button" class="btn btn-default btn-lg" data-toggle="collapse" data-target="#help">?</button>
					<button type="button" class="btn btn-lg btn-primary" id="aTrigger">A</button>
					<button type="button" class="btn btn-lg btn-success" id="bTrigger">B</button>
					<button type="button" class="btn btn-lg btn-warning" id="cTrigger">C</button>
					<button type="button" class="btn btn-lg btn-danger" id="rTrigger">
						<span class="glyphicon glyphicon-step-backward" style="width:15px"></span>
					</button>
					<button type="button" class="btn btn-lg btn-danger" id="nTrigger">
						<span class="glyphicon glyphicon-fast-forward" style="width:15px"></span>
					</button>
					<button type="button" class="btn btn-default btn-lg" data-toggle="collapse" data-target="#playerInfo">
						<span class="glyphicon glyphicon-info-sign" style="width:15px"></span>
					</button>
					<!-- Button trigger modal -->
					<button type="button" class="btn btn-default btn-lg" data-toggle="modal" data-target="#addTagModal" id="addTagModalBtn">
						<span class="glyphicon glyphicon-pencil" style="width:15px"></span>
					</button>
					<!-- Add Tag Modal -->
					<div class="modal fade" id="addTagModal" tabindex="-1" role="dialog" aria-labelledby="addTagModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
									<h4 class="modal-title" id="addTagModalLabel">Add Tag</h4>
								</div>
								<div class="modal-body">
									<div id="tagInfo"></div>
									<div class="form-group">
										<label for="tagText">Notes:</label>
										<input class="form-control" id="tagText" type="text">
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
									<button type="button" class="btn btn-primary" id="addTag">Add</button>
								</div>
							</div>
						</div>
					</div>

					<!-- Button trigger modal -->
					<button type="button" class="btn btn-default btn-lg" data-toggle="modal" data-target="#tagListModal" id="tagListModalBtn">
						<span class="glyphicon glyphicon-list" style="width:15px"></span>
					</button>
					<!-- Tag List Modal -->
					<div class="modal fade" id="tagListModal" tabindex="-1" role="dialog" aria-labelledby="tagListModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
									<h4 class="modal-title" id="tagListModalLabel">Tag List</h4>
								</div>
								<div class="modal-body">
									<div id="tagArea"></div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>


				</div>
				<div id="help" class="collapse">
					<div id="myCarousel" class="carousel slide" data-ride="carousel">
						<ol class="carousel-indicators">
							<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
							<li data-target="#myCarousel" data-slide-to="1" class=""></li>
							<li data-target="#myCarousel" data-slide-to="2" class=""></li>
						</ol>
						<div class="carousel-inner" role="listbox">
							<div class="item active">
								<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
								<div class="container">
									<div class="carousel-caption">
										<h1>Example headline.</h1>
										<p>Note: If you're viewing this page via a <code>file://</code> URL, the "next" and "previous" Glyphicon buttons on the left and right might not load/display properly due to web browser security rules.</p>
										<p><a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a></p>
									</div>
								</div>
							</div>
							<div class="item">
								<img src="data:image/gif;base64,R0lGODlhAQABAIAAAGZmZgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
								<div class="container">
									<div class="carousel-caption">
										<h1>Another example headline.</h1>
										<p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
										<p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
									</div>
								</div>
							</div>
							<div class="item">
								<img src="data:image/gif;base64,R0lGODlhAQABAIAAAFVVVQAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Third slide">
								<div class="container">
									<div class="carousel-caption">
										<h1>One more for good measure.</h1>
										<p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
										<p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
									</div>
								</div>
							</div>
						</div>
						<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> 
						<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a>
					</div>
					<p>This is a AB repeater, and you can follow the instruction as below: </p>
					<p>A: Tag start position</p>
					<p>B: Tag end position</p>
					<p>C: Clear start and end position</p>
				</div>
				<div id="playerInfo" class="collapse in">
					<table class="table">
						<thead>
							<tr><th>Info</th></tr>
						</thead>
						<tbody>
							<tr><td>State: </td><td><span id="state"></span></td></tr>
							<tr><td>Position: </td><td><span id="position"></span></td></tr>
							<tr><td>Duration: </td><td><span id="duration"></span></td></tr>
						</tbody>
					</table>
				</div>
				<div class="row">
					<div class="col-xs-4" style="text-align:center">
						<label for="startTimeLShift">Left Shift</label>
						<div>
							<button type="button" class="btn btn-primary" id="startTimeLShift">-</button>
						</div>
					</div>
					<div class="col-xs-4" style="text-align:center">
						<label for="startTime">Start Time(s)</label>
						<input class="form-control" id="startTime" type="text">
					</div>
					<div class="col-xs-4" style="text-align:center">
						<label for="startTimeLShift">Right Shift</label>
						<div>
							<button type="button" class="btn btn-primary" id="startTimeRShift">+</button>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-4" style="text-align:center">
						<label for="endTimeLShift">Left Shift</label>
						<div>
							<button type="button" class="btn btn-success" id="endTimeLShift">-</button>
						</div>
					</div>
					<div class="col-xs-4" style="text-align:center">
						<label for="endTime">End Time(s)</label>
						<input class="form-control" id="endTime" type="text">
					</div>
					<div class="col-xs-4" style="text-align:center">
						<label for="endTimeLShift">Right Shift</label>
						<div>
							<button type="button" class="btn btn-success" id="endTimeRShift">+</button>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-3"></div>
		</div>
	</div>
	<script language="javascript" type="text/javascript" src="js/jquery.js"></script>
	<div id="test">
	</div>
	<script>
	</script>
    <script src="js/react-with-addons.js"></script>
    <script src="js/browser.min.js"></script>
	<script type="text/babel">
        var ThumbNail = React.createClass({
            getInitialState: function() {
				return null; 
            },
            handleChange:function(){
            },
            componentDidMount: function() {
            },
            render: function() {
				var imgSrc="http://img.youtube.com/vi/"+this.props.vid+"/1.jpg"; 
                return (
					<div className="row">
						<div className="col-xs-6 col-md-3">
							<a href="#" class="thumbnail">
								<img src={imgSrc} alt="180x100%" data-holder-rendered="true" ></img>
							</a>
						</div>
					</div>
                );
            }
        });
		function createThumbNail(div, vid){
			var divObj=document.getElementById(div); 
			React.render(
				<ThumbNail vid={vid}/>,
				divObj
			);
		}
		//createThumbNail("test", "R5Ty4e2UVME");
	</script>
	<script>
        var ThumbNail = React.createClass({displayName: "ThumbNail",
            getInitialState: function() {
                return null; 
            },
            handleChange:function(){
            },
            componentDidMount: function() {
            },
            render: function() {
                var imgSrc="http://img.youtube.com/vi/"+this.props.vid+"/1.jpg"; 
                return (
                    React.createElement("div", {className: "row"}, 
                        React.createElement("div", {className: "col-xs-6 col-md-3"}, 
                            React.createElement("a", {href: "#", class: "thumbnail"}, 
                                React.createElement("img", {src: imgSrc, alt: "180x100%", "data-holder-rendered": "true"})
                            )
                        )
                    )
                );
            }
        });
        function createThumbNail(div, vid){
            var divObj=document.getElementById(div); 
            React.render(
                React.createElement(ThumbNail, {vid: vid}),
                divObj
            );
        }
        var TagInfo = React.createClass({displayName: "TagInfo",
            getInitialState: function() {
                return null;
            },
            handleChange:function(){
            },
            componentDidMount: function() {
            },
            render: function() {
                return (
                    React.createElement("table", {className: "table"}, 
                        React.createElement("thead", null, 
                            React.createElement("tr", null, React.createElement("th", null, "Info: "))
                        ), 
                        React.createElement("tbody", null, 
                            React.createElement("tr", null, React.createElement("td", null, "Title: "), React.createElement("td", null, this.props.title)), 
                            React.createElement("tr", null, React.createElement("td", null, "Video ID: "), React.createElement("td", null, this.props.vid)), 
                            React.createElement("tr", null, React.createElement("td", null, "Start Time: "), React.createElement("td", null, this.props.startTime)), 
                            React.createElement("tr", null, React.createElement("td", null, "End Time: "), React.createElement("td", null, this.props.endTime))
                        )
                    )
                );
            }
        });
        var PlayerInfo = React.createClass({displayName: "PlayerInfo",
            getInitialState: function() {
                return null;
            },
            handleChange:function(){
            },
            componentDidMount: function() {
            },
            render: function() {
                return (
                    React.createElement("table", {className: "table"}, 
                        React.createElement("thead", null, 
                            React.createElement("tr", null, React.createElement("th", null, "Player Info"))
                        ), 
                        React.createElement("tbody", null, 
                            React.createElement("tr", null, React.createElement("td", null, "State: "), React.createElement("td", null, React.createElement("span", {id: "state"}))), 
                            React.createElement("tr", null, React.createElement("td", null, "Title: "), React.createElement("td", null, React.createElement("span", {id: "title"}))), 
                            React.createElement("tr", null, React.createElement("td", null, "Position: "), React.createElement("td", null, React.createElement("span", {id: "position"}))), 
                            React.createElement("tr", null, React.createElement("td", null, "Duration: "), React.createElement("td", null, React.createElement("span", {id: "duration"})))
                        )
                    )
                );
            }
        });
        function renderTagInfo(div, vid, start, end, title){
            var divObj=document.getElementById(div);
            React.render(
                React.createElement(TagInfo, {vid: vid, startTime: start, endTime: end, title:title}),
                divObj
            );
        }
        $("#addTagModalBtn").click(function(e){
            renderTagInfo("tagInfo", playIndex.vid, playIndex.startTime, playIndex.endTime, playIndex.title);
        }); 
        React.render(
            React.createElement(PlayerInfo, null),
            document.getElementById("playerInfo")
        );

        var TagBtn = React.createClass({displayName: "TagBtn",
            getInitialState: function() {
                return null; 
            },
            handleChange:function(){
            },
            componentDidMount: function() {
            },
            render: function() {
                var spanstylex=this.props.spanstyle;
                return (
                    React.createElement("button", {type: "button", className: "btn btn-default btn-lg", id: this.props.id}, 
                        React.createElement("span", {className: this.props.className, style: spanstylex})
                    )
                );
            }
        });
        function createTagBtn(div, id, c, s){
            var style=s; 
            var divObj=document.getElementById(div); 
            React.render(
                React.createElement(TagBtn, {id: id, className: c, spanstyle: s}),
                divObj
            );
        }
		//createTagBtn("test", "xxx", "glyphicon glyphicon-pause", {});
	</script>
	<script>
		var player,
			tag = document.createElement('script'),
			firstScriptTag = document.getElementsByTagName('script')[6];

		var playIndexArray={}; 

		var playIndex={
			state:0,
			//vid:"jExYHd1yyWc",
			vid:parseYoutubeURL("https://www.youtube.com/watch?v=R5Ty4e2UVME"),
			//vid:parseYoutubeURL("https://www.youtube.com/watch?v=jExYHd1yyWc"),
			//R5Ty4e2UVME
			title:"",
			startTime:0,
			endTime:0,
			position:0,
			duration:0
		}; 
		var logDurationTimer; 
		function makeid()
		{
			var text = "";
			var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
			for( var i=0; i < 5; i++ )
				text += possible.charAt(Math.floor(Math.random() * possible.length));

			return text;
		}

		function updatePlayIndex(ind){
			if(ind.vid.match(playIndex.vid)==null){
				player.loadVideoById({
					videoId:ind.vid
				});
			}
			playIndex.title=ind.title;
			playIndex.vid=ind.vid;
			playIndex.startTime=ind.startTime;
			playIndex.endTime=ind.endTime;
			saveLocalStoragePIDnArray(playIndex);
		}

		function parseYoutubeURL(url){
			var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
			var match = url.match(regExp);
			if (match && match[2].length == 11) {
			  return match[2];
			} else {
			  //error
			  return url; 
			}
		}

		tag.src = "https://www.youtube.com/iframe_api";
		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

		function onPlaybackQualityChange(event) {
			console.log(event);
		}

		function onPlayerStateChange(event) {
			console.log(event);
			if (event.data == YT.PlayerState.PLAYING) {
				$("#state").html("Playing");
				$("#pauseLogo").show();
				$("#playLogo").hide(0);
				playIndex.state=1; 
			}else{
				$("#state").html("Pause");
				$("#pauseLogo").hide(0);
				$("#playLogo").show();
				playIndex.state=0; 
			}
		}

		function playWithVid(vid){
			player.loadVideoById({videoId:vid});
			//player.seekTo($("#startTime").val());
			player.seekTo(playIndex.startTime); 
			player.playVideo();
		}
		function playWithConf(){
			/*
			player.loadVideoById({
				videoId:$("#vid").val(), 
				startSeconds:$("#startTime").val(), 
				endSeconds:$("#endTime").val()
			});
			*/
			//player.seekTo($("#startTime").val());
			player.seekTo(playIndex.startTime); 
			player.playVideo();
		}

		function onReady(event) {
			console.log("onReady");
			//loadLocalStoragePID();
			//$("#vid").val(playIndex.vid);
			function logDuration() {
				var videoData=player.getVideoData();
				if(videoData==null){
					playIndex.title=""; 
				}else{
					playIndex.title=player.getVideoData().title; 
				}
				var positionVal=parseFloat(player.getCurrentTime());
				var durationVal=parseInt(player.getDuration());
				playIndex.position=positionVal; 
				playIndex.duration=durationVal; 
				/*
				var startTimeVal=$("#startTime").val(); 
				var endTimeVal=$("#endTime").val(); 
				*/
				var startTimeVal=playIndex.startTime; 
				var endTimeVal=parseFloat(playIndex.endTime);
				if((endTimeVal>startTimeVal)
				   &&(positionVal>=endTimeVal)){
					//player.seekTo($("#startTime").val());
					player.seekTo(playIndex.startTime);
					//playWithConf();
				}   
				$("#title").text(playIndex.title);
				$("#position").text(positionVal);
				$("#duration").text(durationVal);
				if(logDurationTimer) clearTimeout(logDurationTimer);
				logDurationTimer=window.setTimeout(logDuration, 200);
			}
			logDuration();
			console.log(event);
			//playWithConf();
			$("#vid").change(function(){
				//playWithConf();
				updatePlayIndex({
					vid:parseYoutubeURL($("#vid").val()),
					startTime:playIndex.startTime,
					endTime:playIndex.endTime
				});
				playWithVid(playIndex.vid);
				$("#vid").val(playIndex.vid);
			});
			$("#vid").click(function(){
				$(this).select();
			});
			$("#startTime").change(function(){changeStartTime($(this).val());});
			$("#startTime").keypress(function(e){if(e.which==13){changeStartTime($(this).val());}}); 
			function changeStartTime(s){
				var startTimeVal=parseFloat(s); 
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:startTimeVal,
					endTime:playIndex.endTime
				});
				playWithConf();
			}
			$("#startTimeLShift").click(function(){
				var startTimeVal=parseFloat($("#startTime").val()); 
				startTimeVal-=0.1; 
				startTimeVal=parseFloat(startTimeVal);
				if(startTimeVal<0) startTimeVal=0;
				$("#startTime").val(startTimeVal);
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:startTimeVal,
					endTime:playIndex.endTime
				});
				playWithConf();
			});
			$("#startTimeRShift").click(function(){
				var startTimeVal=parseFloat($("#startTime").val()); 
				startTimeVal=parseFloat(startTimeVal)+0.1; 
				startTimeVal=parseFloat(startTimeVal);
				$("#startTime").val(startTimeVal);
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:startTimeVal,
					endTime:playIndex.endTime
				});
				playWithConf();
			});
			$("#endTime").change(function(){changeEndTime($(this).val());});
			$("#endTime").keypress(function(e){if(e.which==13){changeEndTime($(this).val());}}); 
			function changeEndTime(e){
				var endTimeVal=e; 
				endTimeVal=parseFloat(endTimeVal);
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:playIndex.startTime,
					endTime:endTimeVal
				});
				//playWithConf();
			}
			$("#endTimeLShift").click(function(){
				var endTimeVal=parseFloat($("#endTime").val());
				endTimeVal-=0.1;
				endTimeVal=parseFloat(endTimeVal);
				if(endTimeVal<0) endTimeVal=0; 
				$("#endTime").val(endTimeVal);
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:playIndex.startTime,
					endTime:endTimeVal
				});
			});
			$("#endTimeRShift").click(function(){
				var endTimeVal=parseFloat($("#endTime").val());
				endTimeVal=parseFloat(endTimeVal)+0.1;
				endTimeVal=parseFloat(endTimeVal);
				$("#endTime").val(endTimeVal);
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:playIndex.startTime,
					endTime:endTimeVal
				});
			});
			$("#aTrigger").click(function(){
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:parseFloat($("#position").html()),
					endTime:playIndex.endTime
				});
				$("#startTime").val(playIndex.startTime);
			});
			$("#bTrigger").click(function(){
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:playIndex.startTime,
					endTime:parseFloat($("#position").html())
				});
				$("#endTime").val(playIndex.endTime);
			});
			$("#cTrigger").click(function(){
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:0,
					endTime:0
				});
				$("#startTime").val(0);
				$("#endTime").val(0);
			});
			$("#rTrigger").click(function(){
				playWithConf();
				//player.seekTo(playIndex.startTime);
				//player.seekTo($("#startTime").val());
			});
			$("#addTag").click(function(){
				addTagByRandomName({
					vid:playIndex.vid,
					startTime:playIndex.startTime,
					endTime:playIndex.endTime,
					title:playIndex.title
				});
				$("#addTagModal").modal("hide");
			});
			$("#nTrigger").click(function(){
				updatePlayIndex({
					vid:playIndex.vid,
					startTime:parseFloat(playIndex.endTime),
					endTime:0
				});
				$("#startTime").val(parseFloat(playIndex.startTime));
				$("#endTime").val(0);
				//player.seekTo(playIndex.startTime);
				playWithConf();
				//player.seekTo($("#startTime").val());
			});
			$("#playPause").click(function(){
				if(playIndex.state==1){
					player.pauseVideo();
				}else{
					player.playVideo();
				}
			});
		}

		function onError(event) {
			console.log(event);
		}

		//window.onYouTubeIframeAPIReady = function onYouTubeIframeAPIReady() {
		function onYouTubeIframeAPIReady() {
			console.log("IFRAME API READY!");
			player = new YT.Player("wooot", {
				height: 270,
				width: 320,
				videoId: playIndex.vid,//"jExYHd1yyWc",
				playerVars: {
					//controls: 0,
					iv_load_policy: 3 // Disables annotations.
				},
				events: {
					"onReady": onReady,
					"onStateChange": onPlayerStateChange,
					"onPlaybackQualityChange": onPlaybackQualityChange,
					"onError": onError
				}
			});
		 };
	</script>
	<script language="javascript" type="text/javascript" src="js/bootstrap.js"></script>
	<script language="javascript" type="text/javascript" src="js/bootstrap-editable.js"></script>
<!--
-->
	<script>
		function supportLocalStorage() {
			if(typeof(Storage) !== "undefined") {
				return true;
			} else {
				return false;
			}
		}

		function loadLocalStoragePID(){
			if(supportLocalStorage()){
				/*
				localStorage.removeItem("playIndex");
				localStorage.removeItem("playIndexArray");
				
				*/
				var localPIDStr=localStorage.getItem("playIndex");
				var localPID=JSON.parse(localPIDStr);
				var localPIDAStr=localStorage.getItem("playIndexArray");
				var localPIDA=JSON.parse(localPIDAStr);
				if(localPID){
					playIndex.vid=localPID.vid; 
					playIndex.startTime=parseFloat(0); 
					playIndex.endTime=parseFloat(0);
/*
					playIndex.startTime=parseFloat(localPID.startTime); 
					playIndex.endTime=parseFloat(localPID.endTime);
*/
					$("#startTime").val(playIndex.startTime);
					$("#endTime").val(playIndex.endTime);
				}
				if(localPIDA){
					playIndexArray=localPIDA; 
					for(var name in localPIDA){
						if(playIndexArray[name].note) $("#tagText").val(playIndexArray[name].note); 
						addTagByName(playIndexArray[name], name);
						$("#tagText").val("");
					}
				}
				
			}
		}

		function saveLocalStoragePIDnArray(ind){
			localStorage.setItem('playIndex', JSON.stringify(ind));
			localStorage.setItem('playIndexArray',JSON.stringify(playIndexArray));
		}

		function debuginfo(msg){
			$("#debug").html(msg);
		}

		function addTagByRandomName(ind){
			var randomName=makeid();
			var indobj={};
			indobj.vid=ind.vid; 
			indobj.startTime=ind.startTime; 
			indobj.endTime=ind.endTime; 
			indobj.title=ind.title; 
			playIndexArray[randomName]=indobj; 
			updatePlayIndex(ind);
			addTagByName(ind, randomName);
			saveLocalStoragePIDnArray(ind);
		}
		$.fn.editable.defaults.mode = 'inline';
		function addTagByName(ind, randomName){
			$("#tagArea").prepend("<div class='tagcontent' id="+randomName+">"+"</div>");
			renderTagInfo(randomName, ind.vid, ind.startTime, ind.endTime, ind.title);
			$("#"+randomName).prepend("<div id="+randomName+"ThumbNail></div>");
			createThumbNail(randomName+"ThumbNail", ind.vid);
			$("#"+randomName).append("<span id="+randomName+"PlayDiv class=''></span>");
			$("#"+randomName).append("<span id="+randomName+"PauseDiv class=''></span>");
			$("#"+randomName).append("<span id="+randomName+"RemoveDiv class=''></span>");
			$("#"+randomName).append("<span id="+randomName+"EditDiv class=''></span>");
			$("#"+randomName).append("<div>Note:</div>");
			createTagBtn(randomName+"PlayDiv", randomName+"Play", "glyphicon glyphicon-play", {});
			//createTagBtn(randomName+"PauseDiv", randomName+"Pause", "glyphicon glyphicon-pause", {});
			createTagBtn(randomName+"RemoveDiv", randomName+"Remove", "glyphicon glyphicon-remove", {});
			//createTagBtn(randomName+"EditDiv", randomName+"Edit", "glyphicon glyphicon-pencil", {});
			$("#"+randomName+"Play").click(function(){
				updatePlayIndex(playIndexArray[randomName]);
				$("#startTime").val(playIndex.startTime);
				$("#endTime").val(playIndex.endTime);
				playWithConf();
				$("#tagListModal").modal("hide");
			});
/*
			$("#"+randomName+"Pause").click(function(){
				updatePlayIndex(playIndexArray[randomName]);
				$("#startTime").val(playIndex.startTime);
				$("#endTime").val(playIndex.endTime);
				player.pauseVideo();
			});
*/
			$("#"+randomName+"Remove").click(function(){
				$("#"+randomName).remove();
				delete playIndexArray[randomName];
				saveLocalStoragePIDnArray(playIndex);
			});
/*
			$("#"+randomName+"Edit").click(function(){
				var inputObj=document.getElementById(randomName+"TextInput");
				if(inputObj!==null){
					var inputVal=$("#"+randomName+"TextInput").val();
					$("#"+randomName+"Text").html("");
					//$("#"+randomName+"Text").append(inputVal);
					$("#"+randomName+"Text").append("<div id="+randomName+"noteVal class='noteVal'>"+inputVal+"</div>");
					playIndexArray[randomName].note=inputVal; 
					saveLocalStoragePIDnArray(playIndex);
					return; 
				}
				var noteVal=$("#"+randomName+"noteVal").html();
				$("#"+randomName+"Text").html("");
				$("#"+randomName+"Text").append("<input type='text' class='form-control' id="+randomName+"TextInput ></input>");
				$("#"+randomName+"TextInput").val(noteVal).focus();
				$("#"+randomName+"TextInput").change(function(){
					var inputVal=$(this).val();
					$("#"+randomName+"Text").html("");
					//$("#"+randomName+"Text").append(inputVal);
					$("#"+randomName+"Text").append("<div id="+randomName+"noteVal class='noteVal'>"+inputVal+"</div>");
					playIndexArray[randomName].note=inputVal; 
					saveLocalStoragePIDnArray(playIndex);
				});
				$("#"+randomName+"TextInput").keypress(function(e){
					if(e.which==13){
						var inputVal=$(this).val();
						$("#"+randomName+"Text").html("");
						//$("#"+randomName+"Text").append(inputVal);
						$("#"+randomName+"Text").append("<div id="+randomName+"noteVal class='noteVal'>"+inputVal+"</div>");
						playIndexArray[randomName].note=inputVal; 
						saveLocalStoragePIDnArray(playIndex);
					}
				}); 
			});
*/
			$("#"+randomName).append("<div id="+randomName+"Text style='font-size:20px'></div>");
/*
			$("#"+randomName+"Text").append("<div id="+randomName+"noteVal class='noteVal'>"+$("#tagText").val()+"</div>");
*/
			$("#"+randomName+"Text").append("<a href='#"+randomName+"noteVal' id='"+randomName+"noteVal'>"+$("#tagText").val()+"</a>"); 
			$('#'+randomName+'noteVal').editable({
				type:  'text',
				pk:    1,
				name:  'notes',
				title: 'Enter Notes',
				inputclass:"form-control",
				enablefocus:true,
				emptytext:"Enter Your Notes",
				success: function(response, newValue) {
					playIndexArray[randomName].note=newValue; 
					saveLocalStoragePIDnArray(playIndex);
					return; 
				}
			});
			playIndexArray[randomName].note=$("#tagText").val();
			$("#tagText").val("");
			$("#"+randomName).append("<br/>");
		}

	</script>
	<script>
		var sheetURL;
		var spData = null;
		var arrayData=[]; 
		function composeSheetURL(id, no){
			var url="https://spreadsheets.google.com/feeds/cells/"+id+"/"+no+"/public/values?alt=json-in-script&callback=doData"; 
			return url; 
		}
		function doData(json){
			spData = json.feed.entry;
		}
		function readData(){
			var data=spData;
			var rowData=[];
			var row=0;
			for (var r=0; r<data.length; r++){
				var cell=data[r]["gs$cell"];
				var val=cell["$t"];
				if (cell.col==1) {
					rowData=[];
					arrayData.push(rowData);
					row++;
				}
				rowData.push(val);
			}
		}
	</script>
<!--
	<script src="https://spreadsheets.google.com/feeds/cells/1OUsdQ1d8y6HHzTTGwEmBSvzq9yKzFVHE7UtQl8Dr07E/1/public/values?alt=json-in-script&callback=doData"></script>
-->
	<script>
		function changeVideoList(v){
			$("#vid").val(v);
			$("#startTime").val(0);
			$("#endTime").val(0);
			updatePlayIndex({
				vid:parseYoutubeURL($("#vid").val()),
				startTime:0,
				endTime:0
			});
			playWithVid(playIndex.vid);
			$("#vid").val(playIndex.vid);
		}
		function createVideoList(n, u){
			for(var i=0; i<n.length; i++){
				$("#dropdownMenu1list").append("<li><a href='#video"+i+"' id='video"+i+"' vid='"+u[i]+"'></a></li>");
				$("#video"+i).html(n[i]);
				$("#video"+i).click(function(){
					changeVideoList($(this).attr("vid"));
				});
			}
		}
		$(document).ready(function(){
			loadLocalStoragePID();
			$("#vid").val(playIndex.vid);
			sheetURL=composeSheetURL("1OUsdQ1d8y6HHzTTGwEmBSvzq9yKzFVHE7UtQl8Dr07E", 2);
			$.getScript(sheetURL, function(data, textStatus){
				readData();
				console.log(arrayData.length);
				console.log(arrayData[0]);
				console.log(arrayData[1]);
				createVideoList(arrayData[0], arrayData[1]);
				$("#all").show();
				window.onYouTubeIframeAPIReady=onYouTubeIframeAPIReady; 
			});
		});
	</script>
  </body>
</html>

